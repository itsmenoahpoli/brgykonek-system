<app-auth-layout
  title="Create your account"
  subtitle="Join BrgyKonek to connect with your community"
>
  <form class="space-y-4 sm:space-y-6" [formGroup]="registerForm" (ngSubmit)="onSubmit()">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label for="first_name" class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
        <input id="first_name" type="text" formControlName="first_name" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" [class.border-red-500]="registerForm.get('first_name')?.invalid && registerForm.get('first_name')?.touched" />
      </div>

      <div>
        <label for="middle_name" class="block text-sm font-medium text-gray-700 mb-1">Middle Name</label>
        <input id="middle_name" type="text" formControlName="middle_name" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />
      </div>

      <div>
        <label for="last_name" class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
        <input id="last_name" type="text" formControlName="last_name" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" [class.border-red-500]="registerForm.get('last_name')?.invalid && registerForm.get('last_name')?.touched" />
      </div>

      <div>
        <label for="birthdate" class="block text-sm font-medium text-gray-700 mb-1">Birthdate</label>
        <input id="birthdate" type="date" formControlName="birthdate" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" [class.border-red-500]="registerForm.get('birthdate')?.invalid && registerForm.get('birthdate')?.touched" />
      </div>

      <div class="sm:col-span-2">
        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
        <input id="email" type="email" formControlName="email" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm" [class.border-red-500]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched" />
      </div>

      <div>
        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
        <div class="relative">
          <input id="password" [type]="showPassword ? 'text' : 'password'" formControlName="password" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pr-10" [class.border-red-500]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched" />
          <button type="button" (click)="togglePasswordVisibility()" class="absolute inset-y-0 right-0 flex items-center px-3 focus:outline-none">
            <span class="text-gray-400 text-xs">{{ showPassword ? 'HIDE' : 'SHOW' }}</span>
          </button>
        </div>
        <ul class="mt-2 space-y-1 text-xs">
          <li [class.text-green-600]="passwordValidationStatus.length" [class.text-red-500]="!passwordValidationStatus.length">Minimum 8 and maximum 20 characters</li>
          <li [class.text-green-600]="passwordValidationStatus.uppercase" [class.text-red-500]="!passwordValidationStatus.uppercase">At least one uppercase letter</li>
          <li [class.text-green-600]="passwordValidationStatus.lowercase" [class.text-red-500]="!passwordValidationStatus.lowercase">At least one lowercase letter</li>
          <li [class.text-green-600]="passwordValidationStatus.number" [class.text-red-500]="!passwordValidationStatus.number">At least one number</li>
          <li [class.text-green-600]="passwordValidationStatus.special" [class.text-red-500]="!passwordValidationStatus.special">At least one special character (!&#64;#$%^&*)</li>
        </ul>
      </div>

      <div>
        <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
        <input id="confirmPassword" [type]="showPassword ? 'text' : 'password'" formControlName="confirmPassword" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" [class.border-red-500]="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched" />
      </div>

      <div>
        <label for="province" class="block text-sm font-medium text-gray-700 mb-1">Province</label>
        <input id="province" type="text" formControlName="province" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-gray-100" readonly />
      </div>

      <div>
        <label for="municipality" class="block text-sm font-medium text-gray-700 mb-1">Municipality</label>
        <input id="municipality" type="text" formControlName="municipality" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-gray-100" readonly />
      </div>

      <div>
        <label for="barangay" class="block text-sm font-medium text-gray-700 mb-1">Barangay</label>
        <input id="barangay" type="text" formControlName="barangay" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-gray-100" readonly />
      </div>

      <div>
        <label for="sitio" class="block text-sm font-medium text-gray-700 mb-1">Sitio/Purok</label>
        <select id="sitio" formControlName="sitio" class="block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" [class.border-red-500]="registerForm.get('sitio')?.invalid && registerForm.get('sitio')?.touched">
          <option value="">Select Sitio</option>
          <option value="Maharlika">Maharlika</option>
          <option value="Pilar Village">Pilar Village</option>
          <option value="Happy Village">Happy Village</option>
          <option value="Centro">Centro</option>
          <option value="Sagana">Sagana</option>
          <option value="Crotinda">Crotinda</option>
          <option value="Aplaya">Aplaya</option>
        </select>
      </div>

      <div class="sm:col-span-2">
        <label for="mobile_number" class="block text-sm font-medium text-gray-700 mb-1">Mobile Number</label>
        <div class="relative">
          <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 select-none">+639</span>
          <input id="mobile_number" type="tel" [value]="getMobileDisplay()" (input)="onMobileInput($event)" class="block w-full border border-gray-300 rounded-md pl-12 pr-3 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm" placeholder="XXXXXXXXX" [class.border-red-500]="registerForm.get('mobile_number')?.invalid && registerForm.get('mobile_number')?.touched" />
        </div>
      </div>

      <div class="sm:col-span-2">
        <label for="barangay_clearance" class="block text-sm font-medium text-gray-700 mb-1">Barangay Clearance</label>
        <div class="relative border-2 border-dashed border-gray-300 rounded-lg p-4 sm:p-6 text-center hover:border-indigo-400 transition-colors duration-200" [class.border-red-500]="registerForm.get('barangay_clearance')?.invalid && registerForm.get('barangay_clearance')?.touched" [class.border-indigo-500]="isDragOver" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" (click)="fileInput.click()">
          <input #fileInput id="barangay_clearance" type="file" formControlName="barangay_clearance" accept="image/*,.pdf" class="hidden" (change)="onFileSelected($event)" />
          <div class="space-y-3">
            <p class="text-sm font-medium text-gray-700">
              <span class="text-indigo-600 hover:text-indigo-500 cursor-pointer">Click to upload</span>
              or drag and drop
            </p>
            <p class="text-xs text-gray-500 mt-1">JPG, PNG, GIF, PDF up to 5MB (Optional)</p>
            <div *ngIf="selectedFileName" class="mt-3">
              <div class="flex items-center justify-center space-x-2 bg-green-50 border border-green-200 rounded-md p-2">
                <span class="text-sm text-green-700 font-medium">{{ selectedFileName }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-2">
      <input id="remember_device" type="checkbox" formControlName="rememberDevice" class="h-4 w-4 text-indigo-600 border-gray-300 rounded" />
      <label for="remember_device" class="text-xs sm:text-sm text-gray-700">Remember this device for 30 days</label>
    </div>

    <div *ngIf="errorMessage" class="bg-red-50 border border-red-200 text-red-700 px-3 sm:px-4 py-2 sm:py-3 rounded relative text-sm">
      {{ errorMessage }}
    </div>

    <div>
      <button type="submit" [disabled]="registerForm.invalid || isLoading" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed">
        {{ isLoading ? 'Creating account...' : 'Create account' }}
      </button>
    </div>

    <div class="text-center">
      <p class="text-xs sm:text-sm text-gray-600">
        Already have an account?
        <button type="button" (click)="goToLogin()" class="font-medium text-indigo-600 hover:text-indigo-500">
          Sign in here
        </button>
      </p>
    </div>
  </form>

  <app-status-modal [isVisible]="showSuccessDialog" type="success" title="Registration Successful!" message="Your account has been created successfully. You will be redirected to the login page in a few seconds." [autoCloseDelay]="2000" (modalClosed)="showSuccessDialog = false"></app-status-modal>
</app-auth-layout>


